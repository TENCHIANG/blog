<map version="freeplane 1.8.0">
<!--To view this file, download free mind mapping software Freeplane from http://freeplane.sourceforge.net -->
<node TEXT="java.util.concurrent" FOLDED="false" ID="ID_807898068" CREATED="1606697022326" MODIFIED="1606697168838"><hook NAME="MapStyle">
    <properties show_icon_for_attributes="true" fit_to_viewport="false" edgeColorConfiguration="#808080ff,#ff0000ff,#0000ffff,#00ff00ff,#ff00ffff,#00ffffff,#7c0000ff,#00007cff,#007c00ff,#7c007cff,#007c7cff,#7c7c00ff"/>

<map_styles>
<stylenode LOCALIZED_TEXT="styles.root_node" STYLE="oval" UNIFORM_SHAPE="true" VGAP_QUANTITY="24.0 pt">
<font SIZE="24"/>
<stylenode LOCALIZED_TEXT="styles.predefined" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="default" ICON_SIZE="12.0 pt" COLOR="#000000" STYLE="fork">
<font NAME="SansSerif" SIZE="10" BOLD="false" ITALIC="false"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.details"/>
<stylenode LOCALIZED_TEXT="defaultstyle.attributes">
<font SIZE="9"/>
</stylenode>
<stylenode LOCALIZED_TEXT="defaultstyle.note" COLOR="#000000" BACKGROUND_COLOR="#ffffff" TEXT_ALIGN="LEFT"/>
<stylenode LOCALIZED_TEXT="defaultstyle.floating">
<edge STYLE="hide_edge"/>
<cloud COLOR="#f0f0f0" SHAPE="ROUND_RECT"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.user-defined" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="styles.topic" COLOR="#18898b" STYLE="fork">
<font NAME="Liberation Sans" SIZE="10" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subtopic" COLOR="#cc3300" STYLE="fork">
<font NAME="Liberation Sans" SIZE="10" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.subsubtopic" COLOR="#669900">
<font NAME="Liberation Sans" SIZE="10" BOLD="true"/>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.important">
<icon BUILTIN="yes"/>
</stylenode>
</stylenode>
<stylenode LOCALIZED_TEXT="styles.AutomaticLayout" POSITION="right" STYLE="bubble">
<stylenode LOCALIZED_TEXT="AutomaticLayout.level.root" COLOR="#000000" STYLE="oval" SHAPE_HORIZONTAL_MARGIN="10.0 pt" SHAPE_VERTICAL_MARGIN="10.0 pt">
<font SIZE="18"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,1" COLOR="#0033ff">
<font SIZE="16"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,2" COLOR="#00b439">
<font SIZE="14"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,3" COLOR="#990000">
<font SIZE="12"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,4" COLOR="#111111">
<font SIZE="10"/>
</stylenode>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,5"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,6"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,7"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,8"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,9"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,10"/>
<stylenode LOCALIZED_TEXT="AutomaticLayout.level,11"/>
</stylenode>
</stylenode>
</map_styles>
</hook>
<node TEXT="Executor API 架构" POSITION="right" ID="ID_573201774" CREATED="1606909419192" MODIFIED="1606909556964">
<hook URI="Executor架构.png" SIZE="1.0" NAME="ExternalObject"/>
</node>
<node TEXT="Future 与 Callable 架构" POSITION="right" ID="ID_1022468022" CREATED="1606921179289" MODIFIED="1607504987431">
<hook URI="Future与Callable架构.png" SIZE="1.0" NAME="ExternalObject"/>
</node>
<node TEXT="JDK5" POSITION="right" ID="ID_95140697" CREATED="1606697098384" MODIFIED="1606705945843"/>
<node TEXT="locks" POSITION="left" ID="ID_608132250" CREATED="1606697160008" MODIFIED="1606697223452">
<node TEXT="Lock 接口" ID="ID_77580748" CREATED="1606697208455" MODIFIED="1606697480178">
<node TEXT="ReentrantLock 实现类" ID="ID_1407909515" CREATED="1606697495548" MODIFIED="1606700397947">
<node TEXT="替换 synchronized" ID="ID_469418216" CREATED="1606697541078" MODIFIED="1606699458474"/>
<node TEXT="lock" ID="ID_1562493845" CREATED="1606699458962" MODIFIED="1606699471892">
<node TEXT="要放在 try 外，因为可能会失败" ID="ID_1451882255" CREATED="1606699473165" MODIFIED="1606699491124"/>
<node TEXT="只有获取锁才会执行后面的代码" ID="ID_630264842" CREATED="1606699491703" MODIFIED="1606699503751"/>
<node TEXT="可重入。一个线程可多次获取同一个锁" ID="ID_1169161526" CREATED="1606699506889" MODIFIED="1606699526153"/>
</node>
<node TEXT="unlock" ID="ID_1188568476" CREATED="1606699630601" MODIFIED="1606699637794">
<node TEXT="放在 finally 里，防止线程抛出异常无法解锁" ID="ID_239395516" CREATED="1606699638995" MODIFIED="1606699657923"/>
</node>
<node TEXT="tryLock" ID="ID_1149444551" CREATED="1606699663573" MODIFIED="1606699666531">
<node TEXT="取得锁返回 true" ID="ID_1486630043" CREATED="1606699712334" MODIFIED="1606699733934"/>
<node TEXT="无法取得锁返回 false" ID="ID_1158128496" CREATED="1606699734471" MODIFIED="1606699743070"/>
<node TEXT="不会阻塞线程" ID="ID_1431674986" CREATED="1606699743720" MODIFIED="1606699753455"/>
<node TEXT="可以指定超时" ID="ID_49114369" CREATED="1606699753969" MODIFIED="1606699758528">
<node TEXT="long timeout" ID="ID_648796178" CREATED="1606699760323" MODIFIED="1606699797117"/>
<node TEXT="TimeUnit unit" ID="ID_1494470340" CREATED="1606699797561" MODIFIED="1606699802818"/>
</node>
</node>
<node TEXT="isHeldByCurrentThread" ID="ID_1208534665" CREATED="1606699667374" MODIFIED="1606699685029">
<node TEXT="该锁被当前线程持有" ID="ID_1865024699" CREATED="1606699688224" MODIFIED="1606699697024"/>
<node TEXT="即可调用当前锁的 unlock" ID="ID_1421817024" CREATED="1606699697378" MODIFIED="1606699709193"/>
<node TEXT="死锁的本质在于交叉获取锁" ID="ID_1559818922" CREATED="1606699860607" MODIFIED="1606699871623"/>
<node TEXT="只要把多个资源当做一个整体共同锁否则释放即可" ID="ID_1993566130" CREATED="1606699877226" MODIFIED="1606699915006"/>
</node>
</node>
</node>
<node TEXT="ReadWriteLock 接口" ID="ID_1594552671" CREATED="1606697227686" MODIFIED="1606700097860">
<node TEXT="readLock" ID="ID_613158085" CREATED="1606700068986" MODIFIED="1606700110030">
<node TEXT="返回 Lock" ID="ID_1233277531" CREATED="1606700205653" MODIFIED="1606705744306">
<linktarget COLOR="#b0b0b0" DESTINATION="ID_1233277531" ENDARROW="Default" ENDINCLINATION="88;0;" ID="Arrow_ID_1443525084" SOURCE="ID_1573501230" STARTARROW="None" STARTINCLINATION="88;0;"/>
</node>
</node>
<node TEXT="writeLock" ID="ID_1573501230" CREATED="1606700110392" MODIFIED="1606705744306">
<arrowlink SHAPE="CUBIC_CURVE" COLOR="#000000" WIDTH="2" TRANSPARENCY="200" FONT_SIZE="9" FONT_FAMILY="SansSerif" DESTINATION="ID_1233277531" STARTINCLINATION="88;0;" ENDINCLINATION="88;0;" STARTARROW="NONE" ENDARROW="DEFAULT"/>
</node>
<node TEXT="ReentrantReadWriteLock 实现类" ID="ID_1837924311" CREATED="1606700134955" MODIFIED="1606700391627">
<node TEXT="内部嵌套类 ReadLock WriteLock 实现了 Lock" ID="ID_911666922" CREATED="1606700533399" MODIFIED="1606700601664" VSHIFT_QUANTITY="-1.0 px"/>
<node TEXT="readLock" ID="ID_1210327642" CREATED="1606700457894" MODIFIED="1606700724987">
<node TEXT="返回 ReentrantReadWriteLock.ReadLock" ID="ID_693675979" CREATED="1606700471079" MODIFIED="1606700583807"/>
</node>
<node TEXT="writeLock" ID="ID_127672006" CREATED="1606700463390" MODIFIED="1606700468556">
<node TEXT="返回 ReentrantReadWriteLock.WriteLock" ID="ID_1594088486" CREATED="1606700494372" MODIFIED="1606700503505"/>
</node>
<node TEXT="多个线程读，或者一个线程写" ID="ID_1181095287" CREATED="1606700968817" MODIFIED="1606701031922">
<node TEXT="没有任何写锁，才能获取读锁" ID="ID_384723456" CREATED="1606700926875" MODIFIED="1606700937802"/>
<node TEXT="没有任何写锁和读锁，才能获取写锁" ID="ID_1409456668" CREATED="1606700938316" MODIFIED="1606705728013">
<arrowlink SHAPE="CUBIC_CURVE" COLOR="#b0b0b0" WIDTH="2" TRANSPARENCY="255" FONT_SIZE="9" FONT_FAMILY="SansSerif" DESTINATION="ID_1462321384" STARTINCLINATION="372;0;" ENDINCLINATION="349;0;" STARTARROW="DEFAULT" ENDARROW="NONE"/>
</node>
</node>
</node>
<node TEXT="用于实现 Pessimistic Reading 悲观读取" ID="ID_1462321384" CREATED="1606701751166" MODIFIED="1606705728013">
<linktarget COLOR="#b0b0b0" DESTINATION="ID_1462321384" ENDARROW="None" ENDINCLINATION="349;0;" ID="Arrow_ID_81093446" SOURCE="ID_1409456668" STARTARROW="Default" STARTINCLINATION="372;0;"/>
</node>
<node TEXT="如果读很多写很少" ID="ID_1073358063" CREATED="1606701836890" MODIFIED="1606704549322">
<node TEXT="写线程 Starvation 饥饿" ID="ID_422196193" CREATED="1606702270499" MODIFIED="1606702456379"/>
<node TEXT="写线程迟迟无法获取锁，陷入阻塞" ID="ID_897236546" CREATED="1606702010000" MODIFIED="1606702466276"/>
</node>
</node>
<node TEXT="StampedLock" ID="ID_728132512" CREATED="1606702471741" MODIFIED="1606702478643">
<node TEXT="JDK8" ID="ID_1859631060" CREATED="1606702494880" MODIFIED="1606702503801">
<node TEXT="双向阻塞队列" ID="ID_330076565" CREATED="1606717546619" MODIFIED="1606717548677"/>
</node>
<node TEXT="不可重入" ID="ID_1789675709" CREATED="1606715984254" MODIFIED="1606715990851">
<node TEXT="获取和释放锁中，不应再获取锁，避免产生死锁" ID="ID_892709000" CREATED="1606716539034" MODIFIED="1606716576033"/>
</node>
<node TEXT="乐观读取 Optimistic Reading" ID="ID_576578814" CREATED="1606702506002" MODIFIED="1606702535938">
<node TEXT="乐观地认为“读写同时发生的机会很少”" ID="ID_1413383872" CREATED="1606704611813" MODIFIED="1606704646424"/>
<node TEXT="不需要每次读都锁定，只在已被修改的时候锁定" ID="ID_799828269" CREATED="1606716382265" MODIFIED="1606716414702"/>
<node TEXT="先看有没有被写锁定" ID="ID_582914108" CREATED="1606715603443" MODIFIED="1606716440039">
<node TEXT="已被锁定，说明已被修改" ID="ID_1833716186" CREATED="1606715664135" MODIFIED="1606716447735">
<node TEXT="使用读锁重新取结果" ID="ID_405740248" CREATED="1606715723072" MODIFIED="1606715749740"/>
<node TEXT="或者抛出异常" ID="ID_1033421528" CREATED="1606715701113" MODIFIED="1606715711406"/>
</node>
<node TEXT="未被锁定，说明未被修改" ID="ID_1087078384" CREATED="1606715684036" MODIFIED="1606716454423">
<node TEXT="无需读锁，直接返回结果" ID="ID_1610018972" CREATED="1606715690582" MODIFIED="1606715697749"/>
</node>
</node>
<node TEXT="适用于读多写少，性能比悲观的读写锁要高" ID="ID_578916359" CREATED="1606715784130" MODIFIED="1606715795443"/>
</node>
<node TEXT="writeLock" ID="ID_649039665" CREATED="1606705652902" MODIFIED="1606705671605">
<node TEXT="返回 long 锁定戳记（Stamp）" ID="ID_1017925586" CREATED="1606706062355" MODIFIED="1606706631269">
<linktarget COLOR="#b0b0b0" DESTINATION="ID_1017925586" ENDARROW="Default" ENDINCLINATION="196;0;" ID="Arrow_ID_1729224093" SOURCE="ID_542791666" STARTARROW="None" STARTINCLINATION="196;0;"/>
</node>
</node>
<node TEXT="readLock" ID="ID_542791666" CREATED="1606705685818" MODIFIED="1606706323582">
<arrowlink SHAPE="CUBIC_CURVE" COLOR="#000000" WIDTH="2" TRANSPARENCY="200" FONT_SIZE="9" FONT_FAMILY="SansSerif" DESTINATION="ID_1017925586" STARTINCLINATION="196;0;" ENDINCLINATION="196;0;" STARTARROW="NONE" ENDARROW="DEFAULT"/>
</node>
<node TEXT="tryOptimisticRead" ID="ID_448352483" CREATED="1606705822614" MODIFIED="1606705924699">
<node TEXT="乐观读锁" ID="ID_446946501" CREATED="1606716039035" MODIFIED="1606716043994"/>
<node TEXT="返回可以稍后 validate 的戳记，不会真锁" ID="ID_1234068216" CREATED="1606705838982" MODIFIED="1606707867219"/>
<node TEXT="如当前锁没有被持有返回 0" ID="ID_1417263950" CREATED="1606706353497" MODIFIED="1606716297237">
<arrowlink SHAPE="LINE" COLOR="#000000" WIDTH="2" TRANSPARENCY="200" FONT_SIZE="9" FONT_FAMILY="SansSerif" DESTINATION="ID_1417263950" STARTINCLINATION="0;0;" ENDINCLINATION="0;0;" STARTARROW="NONE" ENDARROW="DEFAULT"/>
<linktarget COLOR="#b0b0b0" DESTINATION="ID_1417263950" ENDARROW="Default" ENDINCLINATION="0;0;" ID="Arrow_ID_1506224190" SOURCE="ID_1417263950" STARTARROW="None" STARTINCLINATION="0;0;"/>
</node>
</node>
<node TEXT="validate" ID="ID_1275486230" CREATED="1606705880950" MODIFIED="1606705888753">
<node TEXT="如果锁在发行给定戳记后没有被持有，返回 true" ID="ID_1596495693" CREATED="1606705889925" MODIFIED="1606716293796">
<node TEXT="说明没被别的线程更改，直接返回结果即可，无需锁定或解锁" ID="ID_1038290343" CREATED="1606707232260" MODIFIED="1606716365476"/>
</node>
<node TEXT="如果被持有，返回 false" ID="ID_1184733685" CREATED="1606707590305" MODIFIED="1606716308207">
<node TEXT="要执行 readLock 获取读锁，然后取得最新的值" ID="ID_1765093911" CREATED="1606706792891" MODIFIED="1606716336505"/>
</node>
<node TEXT="validate 之后又发生写入而返回结果不一致是可能的" ID="ID_1370013997" CREATED="1606706961176" MODIFIED="1606707013486"/>
<node TEXT="如果在意应采用完全锁定" ID="ID_1882175825" CREATED="1606707014023" MODIFIED="1606707025750"/>
</node>
<node TEXT="unlockWrite" ID="ID_1840733988" CREATED="1606705755378" MODIFIED="1606705762545">
<node TEXT="接收戳记" ID="ID_1671430424" CREATED="1606705781302" MODIFIED="1606708474278">
<linktarget COLOR="#b0b0b0" DESTINATION="ID_1671430424" ENDARROW="Default" ENDINCLINATION="99;0;" ID="Arrow_ID_352019836" SOURCE="ID_1121210611" STARTARROW="None" STARTINCLINATION="99;0;"/>
</node>
</node>
<node TEXT="unlockRead" ID="ID_1121210611" CREATED="1606705763307" MODIFIED="1606705791800">
<arrowlink SHAPE="CUBIC_CURVE" COLOR="#000000" WIDTH="2" TRANSPARENCY="200" FONT_SIZE="9" FONT_FAMILY="SansSerif" DESTINATION="ID_1671430424" STARTINCLINATION="99;0;" ENDINCLINATION="99;0;" STARTARROW="NONE" ENDARROW="DEFAULT"/>
</node>
<node TEXT="持有锁定、独占锁定、完全锁定、排他锁定是同义词" ID="ID_1930804625" CREATED="1606707748111" MODIFIED="1606716263735"/>
</node>
<node TEXT="Condition" ID="ID_210923555" CREATED="1606697236446" MODIFIED="1606697243545">
<node TEXT="搭配 Lock 替换 synchronized wait notify notifyAll" ID="ID_1389189105" CREATED="1606890982105" MODIFIED="1606891024716"/>
<node TEXT="lock.newCondition 创建实例" ID="ID_1334392822" CREATED="1606891098857" MODIFIED="1606891113751">
<node TEXT="signal --- notify" ID="ID_350435574" CREATED="1606891035191" MODIFIED="1606891046103"/>
<node TEXT="signalAll --- notifyAll" ID="ID_1040232769" CREATED="1606891047249" MODIFIED="1606891056207"/>
<node TEXT="await --- wait" ID="ID_1668563690" CREATED="1606891057234" MODIFIED="1606891094842"/>
</node>
<node TEXT="消费者生产者分离" ID="ID_899429434" CREATED="1606891243658" MODIFIED="1606891267904">
<node TEXT="分别等待和通知" ID="ID_1977566506" CREATED="1606891267906" MODIFIED="1606891272582"/>
<node TEXT="提高性能" ID="ID_1614227278" CREATED="1606891272878" MODIFIED="1606891278124"/>
</node>
</node>
</node>
<node TEXT="synchronized 限制" POSITION="right" ID="ID_1838962134" CREATED="1606697309664" MODIFIED="1606697331505">
<node TEXT="线程必须取得锁才能执行" ID="ID_981871110" CREATED="1606697333759" MODIFIED="1606697373558"/>
<node TEXT="未取得锁的线程直接被阻塞" ID="ID_1771579362" CREATED="1606697374953" MODIFIED="1606697390556"/>
<node TEXT="无法直接“未取得锁时先做别的”" ID="ID_1263299120" CREATED="1606697394182" MODIFIED="1606697430343"/>
<node TEXT="配合 wait notify notifyAll 更复杂" ID="ID_11498507" CREATED="1606697447136" MODIFIED="1606697468275"/>
</node>
<node TEXT="Executor 接口" POSITION="right" ID="ID_219357312" CREATED="1606891373404" MODIFIED="1606892780843">
<node TEXT="管理 Thread 对象" ID="ID_163030806" CREATED="1606915476352" MODIFIED="1606915484041"/>
<node TEXT="execute 方法" ID="ID_629345215" CREATED="1606891848882" MODIFIED="1606891858367">
<node TEXT="接收 Runnable 任务" ID="ID_1242691946" CREATED="1606891528657" MODIFIED="1606891804009"/>
</node>
<node TEXT="Runnable 任务和怎么执行分离" ID="ID_52588681" CREATED="1606891540505" MODIFIED="1606915411354">
<node TEXT="任务在当前线程执行" ID="ID_1297572969" CREATED="1606891694845" MODIFIED="1606891809347">
<node ID="ID_734913265" CREATED="1606891929276" MODIFIED="1606917289751"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      <span style="color: #0033b3"><font color="#0033b3">new </font></span><span style="color: #000000"><font color="#000000">Executor</font></span>() {<br/>&nbsp;&nbsp;&nbsp; <span style="color: #0033b3"><font color="#0033b3">public void </font></span><span style="color: #00627a"><font color="#00627a">execute</font></span>(<span style="color: #000000"><font color="#000000">Runnable </font></span>r) { r.run(); }<br/>}.execute(() -&gt; {});
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="一个任务一个线程" ID="ID_603591952" CREATED="1606891764862" MODIFIED="1606891793688">
<node ID="ID_1067652739" CREATED="1606892421213" MODIFIED="1606917570428"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      <span style="color: #0033b3"><font color="#0033b3">new </font></span><span style="color: #000000"><font color="#000000">Executor</font></span>() {<br/>&nbsp;&nbsp;&nbsp; <span style="color: #0033b3"><font color="#0033b3">public void </font></span><span style="color: #00627a"><font color="#00627a">execute</font></span>(<span style="color: #000000"><font color="#000000">Runnable </font></span>r) { <span style="color: #0033b3"><font color="#0033b3">new </font></span>Thread(r).start(); }<br/>}.execute(() -&gt; {});
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node TEXT="任务在线程池执行" ID="ID_1901230493" CREATED="1606891818301" MODIFIED="1606891823027">
<node ID="ID_1548054582" CREATED="1606892442671" MODIFIED="1606917607221"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      <span style="color: #000000"><font color="#000000">Executors</font></span>.<span style="font-style: italic"><i>newCachedThreadPool</i></span>().execute(() -&gt; {});
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
</node>
<node TEXT="ExecutorService 接口" POSITION="right" ID="ID_207242173" CREATED="1606914843054" MODIFIED="1606914859114">
<node TEXT="具有生命周期的 Executor" ID="ID_182503089" CREATED="1606915428779" MODIFIED="1606915453406"/>
<node TEXT="shutdown" ID="ID_119111636" CREATED="1606914859125" MODIFIED="1606915195316">
<node TEXT="有序关闭任务" ID="ID_1331491027" CREATED="1607483852907" MODIFIED="1607483950090"/>
<node TEXT="不接受任何新任务，对于已关闭的则不起作用" ID="ID_193566178" CREATED="1607483859732" MODIFIED="1607484102297"/>
</node>
<node TEXT="shutdownNow" ID="ID_167844327" CREATED="1607498739774" MODIFIED="1607498746893">
<node TEXT="尝试停止正在执行的任务" ID="ID_871101166" CREATED="1607498869814" MODIFIED="1607498879795"/>
<node TEXT="停止正在等待的任务" ID="ID_381863570" CREATED="1607498880840" MODIFIED="1607498888137">
<node TEXT="并返回 List&lt;Runnable&gt;" ID="ID_875545283" CREATED="1607498830106" MODIFIED="1607498929399"/>
</node>
</node>
<node TEXT="submit" ID="ID_1120844112" CREATED="1606915195740" MODIFIED="1606915199174">
<node TEXT="接收 Callable 或 Runnable 任务" ID="ID_1911964372" CREATED="1607481448450" MODIFIED="1607484053566"/>
<node TEXT="返回 Future" ID="ID_1096667674" CREATED="1607481455612" MODIFIED="1607481505507"/>
<node TEXT="Future&lt;?&gt; submit(Runnable)" ID="ID_461132330" CREATED="1607484342397" MODIFIED="1607484363472">
<node TEXT="get 返回 null" ID="ID_477539290" CREATED="1607484407956" MODIFIED="1607484412573"/>
</node>
<node TEXT="Future&lt;T&gt; submit(Runnable, T)" ID="ID_448476010" CREATED="1607484363878" MODIFIED="1607484381472">
<node TEXT="get 返回指定 T" ID="ID_1492052540" CREATED="1607484415173" MODIFIED="1607484574921"/>
</node>
<node TEXT="Future&lt;T&gt; submit(Callable&lt;T&gt;)" ID="ID_1980430052" CREATED="1607484369015" MODIFIED="1607484394434"/>
</node>
<node TEXT="invokeAll" ID="ID_890896298" CREATED="1606915199596" MODIFIED="1606915209582">
<node TEXT="接收 Collection&lt;Callable&lt;T&gt;&gt;" ID="ID_119812074" CREATED="1607482220927" MODIFIED="1607499138815">
<node TEXT="任务存于 Collection" ID="ID_1430468284" CREATED="1607482680018" MODIFIED="1607482723970"/>
</node>
<node TEXT="返回 List&lt;Future&lt;T&gt;&gt;" ID="ID_893545252" CREATED="1607482254819" MODIFIED="1607483495328">
<node TEXT="每个任务都要完成" ID="ID_18388906" CREATED="1607482705678" MODIFIED="1607482711537"/>
<node TEXT="遍历 Future 的 get 时，是有序，但阻塞" ID="ID_488590610" CREATED="1607503394757" MODIFIED="1607503421163"/>
<node TEXT="可使用 ExecutorCompletionService 包装一下" ID="ID_973195752" CREATED="1607503437674" MODIFIED="1607503449421"/>
</node>
</node>
<node TEXT="invokeAny" ID="ID_1763364020" CREATED="1606915210184" MODIFIED="1606915383262">
<node TEXT="接收 Collection&lt;Callable&lt;T&gt;&gt;" ID="ID_427079164" CREATED="1607482332741" MODIFIED="1607499140583"/>
<node TEXT="返回一个结果 T" ID="ID_1718932392" CREATED="1607499113189" MODIFIED="1607499120909">
<node TEXT="只要有一个任务完成" ID="ID_1084033648" CREATED="1607482712487" MODIFIED="1607499123473"/>
<node TEXT="一般用于搜索" ID="ID_750016739" CREATED="1607499475351" MODIFIED="1607499479543"/>
</node>
<node TEXT="也可接收超时" ID="ID_1726079599" CREATED="1607499164732" MODIFIED="1607499177895">
<node TEXT="TimeoutException" ID="ID_840687603" CREATED="1607499177908" MODIFIED="1607499186225"/>
</node>
</node>
<node TEXT="这些方法出现了 Future Callable 接口" ID="ID_1854328545" CREATED="1607480135791" MODIFIED="1607480154017"/>
</node>
<node TEXT="ExecutorCompletionService" POSITION="right" ID="ID_1533556233" CREATED="1607503456372" MODIFIED="1607503458495">
<node TEXT="实现 CompletionService 接口" ID="ID_248209722" CREATED="1607503458507" MODIFIED="1607503466063">
<node TEXT="包装一下 ExecutorService 使之获取结果时无序但不阻塞" ID="ID_1558463196" CREATED="1607503990482" MODIFIED="1607504221994"/>
<node TEXT="与 ExecutorService 很像也有 submit" ID="ID_1117571464" CREATED="1607503498658" MODIFIED="1607503592514"/>
</node>
<node TEXT="但多了" ID="ID_1313518090" CREATED="1607503597776" MODIFIED="1607503606339">
<node TEXT="take" ID="ID_1544800565" CREATED="1607503606351" MODIFIED="1607503608328">
<node TEXT="若都没完成则等待" ID="ID_22465073" CREATED="1607503814852" MODIFIED="1607503890520"/>
</node>
<node TEXT="poll" ID="ID_1896054304" CREATED="1607503609457" MODIFIED="1607503612053">
<node TEXT="若都没完成则返回 null" ID="ID_421452286" CREATED="1607503894093" MODIFIED="1607503915619"/>
<node TEXT="可指定超时" ID="ID_1571910304" CREATED="1607503917355" MODIFIED="1607503921514">
<node TEXT="InterruptedException" ID="ID_1732890259" CREATED="1607503921527" MODIFIED="1607503922195"/>
</node>
</node>
<node TEXT="返回并出队一个已完成的任务" ID="ID_1641171585" CREATED="1607503884765" MODIFIED="1607503887997"/>
</node>
<node TEXT="维护阻塞队列，过 take poll 获取一个已完成的 Future" ID="ID_562512133" CREATED="1607503675506" MODIFIED="1607503677723"/>
<node TEXT="但不要把 submit 和 take 放到一个循环，虽然顺序了，但也阻塞了，相当于添加一个执行一个" ID="ID_143706787" CREATED="1607503950734" MODIFIED="1607503962596"/>
</node>
<node TEXT="Executors 工具类" POSITION="right" ID="ID_1454421036" CREATED="1606895038133" MODIFIED="1606895058550">
<node TEXT="静态工厂方法" ID="ID_1259671036" CREATED="1607486729709" MODIFIED="1607486735148"/>
<node TEXT="创建 ThreadPoolExecutor 实例" ID="ID_773450896" CREATED="1606895660135" MODIFIED="1606895765691">
<node TEXT="newCachedThreadPool" ID="ID_1042054728" CREATED="1606895059728" MODIFIED="1606895643092">
<node TEXT="必要时建立线程" ID="ID_581778255" CREATED="1606895904927" MODIFIED="1606895916031"/>
<node TEXT="任务运行在新建线程，或复用" ID="ID_1565036163" CREATED="1606895916656" MODIFIED="1606895936063"/>
<node TEXT="空闲线程保留 60s" ID="ID_1438904176" CREATED="1607484578386" MODIFIED="1607484586416"/>
</node>
<node TEXT="newFixedThreadPool" ID="ID_661933125" CREATED="1606895643494" MODIFIED="1606895658278">
<node TEXT="指定固定线程" ID="ID_865521557" CREATED="1606895939788" MODIFIED="1606895980939"/>
<node TEXT="空闲线程一直保留" ID="ID_967620925" CREATED="1607484593444" MODIFIED="1607484598629"/>
</node>
<node TEXT="都兼容 ExecutorService 接口" ID="ID_1960447" CREATED="1606895839118" MODIFIED="1606895985169">
<node TEXT="线程池服务行为" ID="ID_1888675546" CREATED="1606895868867" MODIFIED="1606895875635"/>
</node>
<node TEXT="都支持 ThreadFactory 实例" ID="ID_1571896503" CREATED="1606896107705" MODIFIED="1606896158946"/>
<node TEXT="newSingleThreadExecutor" ID="ID_1978379700" CREATED="1607484620703" MODIFIED="1607484632250">
<node TEXT="只有一个线程" ID="ID_470485632" CREATED="1607484632261" MODIFIED="1607484636092"/>
<node TEXT="顺序执行每一个任务" ID="ID_666673103" CREATED="1607484636273" MODIFIED="1607484643958"/>
<node TEXT="类似于 Swing 事件分配线程" ID="ID_519062646" CREATED="1607484646515" MODIFIED="1607484656220"/>
</node>
<node TEXT="newScheduledThreadPool" ID="ID_91791482" CREATED="1607484659156" MODIFIED="1607484672992">
<node TEXT="用于预定执行（Scheduled Execution）" ID="ID_1523623526" CREATED="1607484673003" MODIFIED="1607497640116"/>
<node TEXT="替代 java.util.Timer" ID="ID_294687386" CREATED="1607484692217" MODIFIED="1607484701731"/>
<node TEXT="返回 ScheduledExecutorService 对象" ID="ID_1297728975" CREATED="1607497854953" MODIFIED="1607498115720"/>
<node TEXT="可指定任务多久才执行或周期性执行" ID="ID_1958325754" CREATED="1607498132638" MODIFIED="1607498495699"/>
</node>
<node TEXT="newSingleThreadScheduledPool" ID="ID_1839054415" CREATED="1607497835719" MODIFIED="1607497851136"/>
<node TEXT="getLargestPoolSize" ID="ID_1148754962" CREATED="1607484148026" MODIFIED="1607484165710">
<node TEXT="返回池中最大线程数" ID="ID_436174711" CREATED="1607484165721" MODIFIED="1607484173020"/>
<node TEXT="ExecutorService 先转为 ThreadPoolExecutor" ID="ID_1704596949" CREATED="1607484210964" MODIFIED="1607484232053"/>
</node>
</node>
</node>
<node TEXT="ScheduledExecutorService" POSITION="right" ID="ID_1047724558" CREATED="1607498075390" MODIFIED="1607498083273">
<node TEXT="为 ExecutorService 子接口" ID="ID_716062805" CREATED="1607497942661" MODIFIED="1607497955059"/>
<node TEXT="多久之后执行" ID="ID_1766630151" CREATED="1607498461169" MODIFIED="1607498477445">
<node TEXT="schedule" ID="ID_295004291" CREATED="1607498215633" MODIFIED="1607498230948">
<node TEXT="Callable&lt;V&gt;, long, TimeUnit" ID="ID_1050768186" CREATED="1607498230959" MODIFIED="1607498297349">
<node TEXT="返回 ScheduledFuture&lt;V&gt;" ID="ID_744122357" CREATED="1607498309973" MODIFIED="1607498321664"/>
</node>
<node TEXT="Runnable, long, TimeUnit" ID="ID_716962342" CREATED="1607498297675" MODIFIED="1607498301516">
<node TEXT="返回 ScheduledFuture&lt;?&gt;" ID="ID_333611359" CREATED="1607498323479" MODIFIED="1607498326136"/>
</node>
</node>
</node>
<node TEXT="周期执行" ID="ID_91841586" CREATED="1607498481029" MODIFIED="1607498484364">
<node TEXT="scheduleAtFixedRate" ID="ID_60412792" CREATED="1607498330495" MODIFIED="1607498377112">
<node TEXT="Runnable, long, long, TimeUnit" ID="ID_50597133" CREATED="1607498401968" MODIFIED="1607498422549"/>
<node TEXT="第一个 long 初始延迟" ID="ID_1452381323" CREATED="1607498511184" MODIFIED="1607498525265"/>
<node TEXT="第二个 long 完成再算周期" ID="ID_1361043093" CREATED="1607498525592" MODIFIED="1607498597892"/>
</node>
<node TEXT="shceduleWithFixedDelay" ID="ID_534619747" CREATED="1607498364436" MODIFIED="1607498386103">
<node TEXT="Runnable, long, long, TimeUnit" ID="ID_318746814" CREATED="1607498434021" MODIFIED="1607498450609"/>
<node TEXT="第一个 long 初始延迟" ID="ID_874694583" CREATED="1607498511184" MODIFIED="1607498525265"/>
<node TEXT="第二个 long 完成再算周期" ID="ID_1572032877" CREATED="1607498525592" MODIFIED="1607498597892"/>
</node>
</node>
</node>
<node TEXT="ThreadFactory 接口" POSITION="right" ID="ID_1771176150" CREATED="1606896020134" MODIFIED="1606896049201">
<node TEXT="Thread newThread(Runnable)" ID="ID_239830685" CREATED="1606896051546" MODIFIED="1606896066789"/>
<node TEXT="定义如何建立线程" ID="ID_1177523555" CREATED="1606896160472" MODIFIED="1606896162689"/>
</node>
<node TEXT="Future" POSITION="right" ID="ID_1737706751" CREATED="1606916125005" MODIFIED="1606917925187">
<node TEXT="在将来取得结果" ID="ID_998934115" CREATED="1606916235004" MODIFIED="1606916240099"/>
<node TEXT="get" ID="ID_832440521" CREATED="1606916251247" MODIFIED="1606916254359">
<node TEXT="以后结果直接返回" ID="ID_1082273351" CREATED="1606916254369" MODIFIED="1606916261569">
<node TEXT="ExecutionException" ID="ID_1747587530" CREATED="1607479650440" MODIFIED="1607479651753">
<node TEXT="report" ID="ID_464524558" CREATED="1607479651767" MODIFIED="1607479656565"/>
</node>
</node>
<node TEXT="没有则阻塞" ID="ID_685481165" CREATED="1606916262017" MODIFIED="1606916276321">
<node TEXT="InterruptedException" ID="ID_74623581" CREATED="1607479639808" MODIFIED="1607479641716">
<node TEXT="awaitDone" ID="ID_944309329" CREATED="1607479641734" MODIFIED="1607479649653"/>
</node>
</node>
<node TEXT="可以指定超时" ID="ID_1956887327" CREATED="1606916277027" MODIFIED="1606916281360">
<node TEXT="java.util.concurrent.TimeoutException" ID="ID_1387288460" CREATED="1606916292228" MODIFIED="1606916337496"/>
<node TEXT="long, TimeUnit" ID="ID_321888411" CREATED="1607486400808" MODIFIED="1607486422060"/>
</node>
</node>
<node TEXT="isDone" ID="ID_355719150" CREATED="1606916358572" MODIFIED="1606916362295">
<node TEXT="任务结束" ID="ID_1197273338" CREATED="1606916362305" MODIFIED="1607486493873">
<node TEXT="正常结束" ID="ID_226673395" CREATED="1607486493884" MODIFIED="1607486496780"/>
<node TEXT="中途取消" ID="ID_1643159207" CREATED="1607486497660" MODIFIED="1607486500054"/>
<node TEXT="发生异常" ID="ID_1463765404" CREATED="1607486500933" MODIFIED="1607486503261"/>
</node>
</node>
<node TEXT="cancel" ID="ID_793153356" CREATED="1607485601201" MODIFIED="1607485603792">
<node TEXT="还没开始，则取消开始" ID="ID_703995104" CREATED="1607485603805" MODIFIED="1607485684597"/>
<node TEXT="已经完成，立刻返回" ID="ID_582097999" CREATED="1607485686010" MODIFIED="1607485701614"/>
<node TEXT="正在计算" ID="ID_1035462720" CREATED="1607485701917" MODIFIED="1607485709055">
<node TEXT="传 true 才中断" ID="ID_1033788322" CREATED="1607485709065" MODIFIED="1607485728978"/>
</node>
</node>
<node TEXT="isCancelled" ID="ID_627618275" CREATED="1607486444765" MODIFIED="1607486460217">
<node TEXT="在完成前被取消" ID="ID_1118494561" CREATED="1607486460229" MODIFIED="1607486468659"/>
</node>
<node TEXT="Future 与 Callable 搭配用" ID="ID_1957436610" CREATED="1606916440943" MODIFIED="1606917928304">
<node TEXT="Callable 给 Future 用" ID="ID_1928398365" CREATED="1606921402815" MODIFIED="1606921414969"/>
<node TEXT="Future 给 Runnable 用" ID="ID_847077629" CREATED="1606921415257" MODIFIED="1606921428691"/>
</node>
<node TEXT="FutureTask" ID="ID_561992048" CREATED="1607480247245" MODIFIED="1607480470680">
<node TEXT="同时实现了 Runnable 和 Future" ID="ID_189964243" CREATED="1607486000532" MODIFIED="1607486011374">
<node TEXT="RunnableFuture" ID="ID_250251827" CREATED="1607486016414" MODIFIED="1607486024393"/>
<node TEXT="实例可作为 Runnable 传给 Thread 构造函数" ID="ID_314910335" CREATED="1607480524489" MODIFIED="1607486084887"/>
<node TEXT="也可当做 Future 使用" ID="ID_341104411" CREATED="1607486085098" MODIFIED="1607486195571"/>
</node>
<node TEXT="构造方法" ID="ID_668073279" CREATED="1607481509226" MODIFIED="1607481513226">
<node TEXT="构造时可接收 Runnable 或 Callable" ID="ID_30513460" CREATED="1607480480515" MODIFIED="1607486124172"/>
<node TEXT="Callable&lt;V&gt;" ID="ID_539074977" CREATED="1607481513238" MODIFIED="1607486523007"/>
<node TEXT="Runnable, V" ID="ID_114785425" CREATED="1607481522915" MODIFIED="1607481545055">
<node TEXT="通过 Executors.callable 方法转为 Callable" ID="ID_1241558550" CREATED="1607481545070" MODIFIED="1607481561152"/>
<node TEXT="V 即为 FutureTask&lt;V&gt; 表示运算的结果" ID="ID_1845726711" CREATED="1607481562640" MODIFIED="1607481598781"/>
<node TEXT="构造既是 Future&lt;V&gt; 又是 Runnable 的对象" ID="ID_1631461973" CREATED="1607486564373" MODIFIED="1607486581880"/>
</node>
</node>
<node TEXT="状态" ID="ID_524381389" CREATED="1607480576250" MODIFIED="1607480585914">
<node TEXT="NEW" ID="ID_1415852090" CREATED="1607480585925" MODIFIED="1607480589814"/>
<node TEXT="COMPLETING" ID="ID_579322341" CREATED="1607480590018" MODIFIED="1607480594060"/>
<node TEXT="NORMAL" ID="ID_1001107688" CREATED="1607480594210" MODIFIED="1607480597020"/>
<node TEXT="EXCEPTIONAL" ID="ID_423949997" CREATED="1607480597186" MODIFIED="1607480602059"/>
<node TEXT="CANCELLED" ID="ID_904462759" CREATED="1607480602251" MODIFIED="1607480604788"/>
<node TEXT="INTERRUPTING" ID="ID_358489517" CREATED="1607480604963" MODIFIED="1607480612694"/>
<node TEXT="INTERRUPTED" ID="ID_1280175511" CREATED="1607480615493" MODIFIED="1607480617035"/>
</node>
<node TEXT="FutureTask 等于是把 Runnable、Callable、Future 和谐统一" ID="ID_98538713" CREATED="1607486133349" MODIFIED="1607486154993"/>
</node>
</node>
<node TEXT="Callable" POSITION="right" ID="ID_1797072396" CREATED="1606916136592" MODIFIED="1606916146594">
<node TEXT="与 Runnable 任务类似" ID="ID_1696392994" CREATED="1606916381535" MODIFIED="1606916400728"/>
<node TEXT="可以返回值" ID="ID_1541843739" CREATED="1606916401145" MODIFIED="1606916418914"/>
<node TEXT="可以抛出受检异常" ID="ID_1879016927" CREATED="1606916419348" MODIFIED="1606916430236"/>
<node TEXT="call 方法" ID="ID_187415197" CREATED="1607480202959" MODIFIED="1607480214907">
<node TEXT="可返回值" ID="ID_946907360" CREATED="1607480214922" MODIFIED="1607480219042"/>
<node TEXT="也可抛出受检异常" ID="ID_1460963189" CREATED="1607480219553" MODIFIED="1607480227324"/>
<node ID="ID_286194585" CREATED="1606916498328" MODIFIED="1606916626140"><richcontent TYPE="NODE">

<html>
  <head>
    
  </head>
  <body>
    <p>
      <span style="color: #9e880d"><font color="#9e880d">@FunctionalInterface<br/></font></span><span style="color: #0033b3"><font color="#0033b3">public interface </font></span><span style="color: #000000"><font color="#000000">Callable</font></span>&lt;<span style="color: #007e8a"><font color="#007e8a">V</font></span>&gt; {<i><font color="#8c8c8c"><span style="color: #8c8c8c; font-style: italic"><br/></span><span style="color: #8c8c8c; font-style: italic">&nbsp;&nbsp;&nbsp;&nbsp; </span></font></i><span style="color: #007e8a"><font color="#007e8a">V </font></span><span style="color: #00627a"><font color="#00627a">call</font></span>() <span style="color: #0033b3"><font color="#0033b3">throws </font></span><span style="color: #000000"><font color="#000000">Exception</font></span>;<br/>}
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
</node>
<node TEXT="执行器总结" POSITION="right" ID="ID_1813765741" CREATED="1607504597042" MODIFIED="1607504601421">
<node TEXT="获取线程池" ID="ID_518893697" CREATED="1607504129951" MODIFIED="1607504135759"/>
<node TEXT="submit 提交任务" ID="ID_1995344994" CREATED="1607504146072" MODIFIED="1607504188815">
<node TEXT="如有多个任务" ID="ID_896163721" CREATED="1607504489237" MODIFIED="1607504493973">
<node TEXT="invokeAny" ID="ID_695343762" CREATED="1607504493985" MODIFIED="1607504498608"/>
<node TEXT="invokeAll" ID="ID_762052819" CREATED="1607504498789" MODIFIED="1607504515826"/>
<node TEXT="ExecutorCompletionService" ID="ID_647311224" CREATED="1607504528258" MODIFIED="1607504529434"/>
</node>
</node>
<node TEXT="在 Future 上" ID="ID_970374584" CREATED="1607504287633" MODIFIED="1607504446340">
<node TEXT=" get 获取结果" ID="ID_1657837750" CREATED="1607504446353" MODIFIED="1607504449689"/>
<node TEXT="cancel 取消任务" ID="ID_872260323" CREATED="1607504449926" MODIFIED="1607504469666"/>
</node>
<node TEXT="shutdown 关闭线程池" ID="ID_1818465689" CREATED="1607504268247" MODIFIED="1607504279329"/>
<node TEXT="不使用线程池则用 FutureTask" ID="ID_1496097950" CREATED="1607504748198" MODIFIED="1607504762481"/>
</node>
</node>
</map>
