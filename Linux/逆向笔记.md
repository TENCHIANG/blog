## 逆向笔记

### 逆向工具

* apktool、AndroidKillwe、jd-gui、IDA

### apktool 解包工具

```sh
apktool d test.apk # 解包
apktool b test -o test_crack.apk # 重打包
```

* 然后再使用 AndroidKillwe 进行签名
* [《教我兄弟学Android逆向番外01 apktool的使用》 - 『移动安全区』 - 吾爱破解 - LCG - LSG |安卓破解|病毒分析|www.52pojie.cn](https://www.52pojie.cn/thread-732007-1-1.html)

### 安卓平台

* armeabiv-v7a: 第7代及以上的 ARM 处理器。2011年15月以后的生产的大部分Android设备都使用它
* arm64-v8a: 第8代、64位ARM处理器，很少设备，三星 Galaxy S6是其中之一
* armeabi: 第5代、第6代的ARM处理器，早期的手机用的比较多
* x86: 平板、模拟器用得比较多
* x86_64: 64位的平板

### CE：Cheat Engine

* 建议选择CE6.4.3风叶人加强版
* 设置 - 扫描设置 - 扫描以下内存区域 - 全部勾选
* 设置 - 调试器选项 - 调试器方法 - 使用 VEH 调试器
* 模拟器的话一般选择Headless或者Handle之类的无头模拟器进程
* 地址清单 - 右键 - 浏览相关内存区域 **Ctrl+B**
  * 右键 - 显示类型 - 4字节十进制
  * 最好一行四个地址显示，方便查看
  * 在这里可以复制特征码
* 地址清单批量改名：Ctrl/Shift+右键选择地址，**Ctrl+Enter**批量改名
* 整形在内存中的表示：
  * 1000 0x000003e8
  * 内存中的表示：e8 03 00 00
* **内存特征码**：在目标内存的附近，选出不变的一段字节，作为特征码，先找特征码，然后根据偏移定位到目标（准确+快速）
  * 进程id
  * 搜索类型：1返回值 2返回地址
  * 机器码：特征码（如"60 91 E3 40 68 16 8B 85 FB FF FF FF"，也可以不加空格）
  * 机器码位置：0
  * 起始地址："10000000"（特征码前面）
  * 结束地址："9fffffff"
  * 大小：4096、40960、[409600]（内存分页、**内存对齐**）
    * 4字节对齐（4K对齐，32位）
    * 8字节对齐（64位）
    * 效率和准确度成反比
    * 大漠插件 FindDataEx 的第四个参数（4）
  * 以上是易语言 `内存读写_特征码搜索`的参数（返回文本类型）
    * 找到的特征码可能**多个**（特征码重复），注意看哪个是对的
  * **代码实现**的话，用特征码比较多（而不是写死）
  * **特征码最佳实践**：找特征码 - 找基准目标 - 找其它很多目标
* **内存数据对比**：
  * 多个模拟器，多个CE，搜索同一个数据，提取相同的特征码（更精准）
  * 提取特征码的时候可以用**16进制1字节**显示，能更好的查看变化
  * **0也可以作为特征码**，前提是前后都要有数据
  * 防止重启更新、防止游戏更新
* 特征码某些字节发生改变：**特征码通配符**
  * 一个字节变化：??
  * 使用**文本对比工具**找出不同的地方，然后替换为通配符（普特文本比较器）
  * 也可以用文本对比工具找出相同的，作为特征码
* **特征码工具**（类人猿特征码工具）
  * 方法思路比答案更重要
  * 特征码离目标数据远（不方便）
  * 模拟器ID1：选择第一个模拟器，然后点击该按钮获取其PID
    * 开始地址填目标数据在第一个模拟器的地址，下同
  * 模拟器ID2：选择第二个模拟器，然CE后点击该按钮获取其PID
    * 开始地址填目标数据在第一个模拟器的地址，与上一个**不一定相同**
  * 选择目标数据的数据类型（CE）
  * 遍历次数：500（查找数据的行数）
  * 选择**加**或者**减**
    * 加：往下找（要减回去）
    * 减：往上找（要加回去）
    * 加减都试一下找到好的特征码（注意符号）
  * 点击**一键遍历**
  * 点击**对比数据**
    * **对比后数据**、**十六字节**字段为空则说明不一样，不为空说明一样
    * 双击**十六字节**字段，添加到结果框（特征码）
    * 或者特征序号开始、特征结束序号（填序号），然后**一键提取特征码**
  * **距离**字段：距离目标的绝对距离（加法则减，减法则加）
  * 直接在工具里找**其他目标数据**
    * 关键字：目标数据的值
    * 列：目标数据值所在列（从0开始）
    * 一般只要特征码对了就没毛病
    * 搜不到就调整**加减**和**遍历次数**
    * 这时候找到的距离不用做任何修改（因为是基于基准目标而不是特征码的）
      * 基准目标数据基于特征码 - 其它目标数据基于基准目标
* 特征码工具功能解析
  * 模拟器进程获取
  * 模拟器内存数据遍历
  * 数据对比获取特征码
  * 64位的模拟器要用**长整型**
* 大漠插件读取内存
  * 收费版7.8以上
* **内存属性**：r、w、x、wx、rwx

### GG：Game Guardian

* CE搜索到的内存地址和GG不一样

### IDA

* 打开 so 文件后，注意是否已经全部反汇编完（ARM汇编）
* 在IDA VIEW-A界面，按空格进入流程图模式
  * 蓝色线代表顺序执行流程
  * 红色先代表分支流程的条件假
  * 蓝色代表条件真
* IDA不是所有函数都能识别出来（sub_ffffff 内存相对偏移地址）
* loc_ffffff 跳转相关
* 打开字符串窗口：View - Open subviews - Strings（Shift+F12）